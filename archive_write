#!/bin/sh
# Write a file to a mass store
#
# Arguments:
# 1 directory on archival system to write file to
#
if [ $# = 1 ] ; then
  ARCHIVE_D=$1
else
  echo "I need an arguments:"
  echo "Directory on archival system to write file to"
  ./update_status error archive_write
  exit 1
fi
#
# If hsi command exists, use it.
#
TEST4HSI=`which hsi 2<&1`
if [ $? -eq 0 ] ; then
  echo "mkdir -p $ARCHIVE_D ; chmod 775 $ARCHIVE_D" > MKDIR
  hsi in MKDIR
  echo ${ARCHIVE_D}" created. Ready." ; rm MKDIR
  echo "cd $ARCHIVE_D ; put -U *nc ; chmod 644 *nc" > PUT
  hsi in PUT
  if [ $? -eq 0 ] ; then
    echo "Files written to "${ARCHIVE_D}
    rm -f PUT 
  else
    echo "Problem with HPSS on write. Stopping"
    ./update_status error archive_write
    exit 1
  fi
else
  echo "Cannot find hsi command."
  ./update_status error archive_write
  exit 1
fi
