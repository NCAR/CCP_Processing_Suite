#!/bin/sh
#
# Store data on archival system
#
if [ $# -ne 0 ] ; then
  echo "Usage: store_to_archive"
  ./update_status error store_to_archive
  exit 1
fi
#
PROCHOST=`hostname`;export PROCHOST
#
cd $CACHEDIR
#
if [ `ls CAT.*.nc | wc -l` -ne 0 ] ; then
  for NC3FILE in `ls CAT.*.nc` ; do
    NC4FILE=`echo $NC3FILE | sed -e 's/^CAT\.//g'`
    if [ `echo $PROCHOST | cut -c1-2` != "c1" ] ; then
      echo -n "TS NC4Z 0 on "${NC3FILE}": " ; date
      $NCKS -4 -L 1 $NC3FILE $NC4FILE
      if [ $? -eq 0 ] ; then
        rm -f $NC3FILE
        echo -n "TS NC4Z 1 on "${NC4FILE}": " ; date
      else
        echo "netCDF-4 L 1 compression failed on "${NC3FILE}
      fi
    else
      mv $NC3FILE $NC4FILE
    fi
  done
fi
../archive_write $ARCHIVE_PROC
#
cd $LOCAL_PROC
