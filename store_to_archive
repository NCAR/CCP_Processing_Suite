#!/bin/sh
#
# Store data on archival system
#
if [ $# -ne 0 ] ; then
  echo "Usage: store_to_archive"
  exit 1
fi
#
cd $CACHEDIR
ln -s -f ${BASEDIR}/mss_write .
#
#
if [ $DO_PROC -ne 0 ] ; then
  LAST=`ls -1 $CASE.*cat*nc | tail -1`
  while [ -f $LAST ] ; do
    for g in `ls $CASE.*cat*nc | head -5` ; do
      ./mss_write $g $MSSPROC &
    done
    wait
  done
fi
#
if [ $DO_CMIP -ne 0 ] ; then
  if [ "$CMIP" = "cm5" ] ; then
    LAST=`ls -1 *-*.nc | tail -1`
    while [ -f $LAST ] ; do
      for g in `ls *-*.nc | head -5` ; do
        ./mss_write $g $MSSCMIP &
      done
      wait
    done
  fi
  if [ "$CMIP" = "cm3" ] ; then
    LAST=`ls *cat*nc | tail -1`
    while [ -f $LAST ] ; do
      for g in `ls *cat*nc | head -5` ; do
        ./mss_write $g $MSSCMIP &
      done
      wait
    done
  fi
fi
