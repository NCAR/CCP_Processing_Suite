#!/bin/sh
# Write a file to a mass store
#
# Arguments:
# 1 file to write
# 2 directory on archival system to write file to
#
if [ $# = 2 ] ; then
  MSSF=$1
  MSSD=$2
else
  echo "I need two arguments:"
  echo "1) file to write"
  echo "2) directory on archival system to write file to"
  exit 1
fi
#
if [ ! -f $MSSF ] ; then
  echo $MMSF" not present, cannot write to the archival system"
  exit 1
fi
#
#
# If NCAR MSS msrcp command exists, use it.
if [ `which msrcp` ] ; then
  msrcp -pe 3652 -class reliability=economy -srcdelete $MSSF "mss:${MSSD}/${MSSF}"
  if [ $? -eq 0 ] ; then
    echo $MSSF" written to "${MSSD}/${MSSF}" and erased."
  else
    echo "Problem with storing "${MSSF}" to "${MSSD}". Stopping."
    exit 1
  fi
else
#
# If NERSC/ORNL hsi command exists, use it.
   if [ `which hsi` ] ; then 
     hsi -q "mkdir -m 775 -p $MSSD ; put -U ${MSSD}/${MSSF}" >& /dev/null
     if [ $? -eq 0 ] ; then
       echo ${MSSF}" written to "${MSSD}" and erased."
       rm -f $MSSF
     else
       hsi -q "put ${MSSF}" >& /dev/null
       if [ $? -eq 0 ] ; then
         echo ${MSSF}" written to your HPSS HOME and erased."
         rm -f $MSSF
       else
         echo "Problem with HPSS on "${MSSF}". Stopping"
         exit 1
       fi
     fi      
   else
     echo "Neither msrcp nor hsi exist."
     exit 1
  fi
fi
